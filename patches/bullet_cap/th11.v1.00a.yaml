
binhacks:
  ExpHP.bullet-cap.install:
    addr: "0x42a51e"
    expected: "be703a4c00"
    codecave:
      - "E8[codecave:ExpHP.bullet-cap.initialize]" # call initialize

      # original code
      - "BE703A4C00        " # mov   esi, 0x4c3a70
      # abs_jmp_hack 0x42a523
      - "E800000000        " # call %%next
      - "C7042423A54200    " # mov dword [esp], %1
      - "C3                " # ret

codecaves:
  # Address range spanned by .text
  ExpHP.bullet-cap.address-range:
    - "00104000          " # dd 0x401000
    - "15AE4800          " # dd 0x48ae15

  ExpHP.bullet-cap.bullet-data:
    - "D0070000          " # dd 0x7d0  ; old bullet count (not counting pre-TD dummy bullet)
    - "10090000          " # dd 0x910  ; size of bullet

  # Here we have a list of numbers related to bullet count, each followed by a blacklist.
  # (i.e. addresses where this dword only appears incidentally and should not be replaced).
  # Each one will be substituted as  value -> value + new_count - old_count.
  ExpHP.bullet-cap.counts-to-replace:
    - "D0070000          " # dd 0x7d0
    - "90C34100          " # dd 0x41c390
    - "53904500          " # dd 0x459053
    - "08B84600          " # dd 0x46b808
    - "00000000          " # dd 0 ; blacklist end

    - "D1070000          " # dd 0x7d1
    - "00000000          " # dd 0

    - "00000000          " # dd 0 ; END

  # Similar to counts_to_replace, but for BulletManager offsets that depend on the final bullet's offset.
  # These will be substituted as  value -> value + bullet_size * (new_count - old_count)
  ExpHP.bullet-cap.offsets-to-replace:
    - "16D24600          " # dd 0x46d216  ; offset of dummy bullet state
    - "00000000          " # dd 0
    - "74D64600          " # dd 0x46d674  ; offset of bullet.anm
    - "00000000          " # dd 0
    - "78D64600          " # dd 0x46d678  ; size of bullet manager
    - "00000000          " # dd 0
    - "10D64600          " # dd 0x46d610  ; size of bullet array
    - "00000000          " # dd 0

    - "00000000          " # dd 0 ; END

  ExpHP.bullet-cap.iat-funcs:
    - "B8B14800          " # .GetLastError: dd 0x48b1b8
    - "74B14800          " # .GetModuleHandleW: dd 0x48b174
    - "70B14800          " # .GetProcAddress: dd 0x48b170
