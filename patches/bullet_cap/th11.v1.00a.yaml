
binhacks:
  ExpHP.bullet-cap.install:
    addr: "0x42a51e"
    expected: "be703a4c00"
    codecave:
      - "E8[codecave:ExpHP.bullet-cap.initialize]" # call initialize

      # original code
      - "BE703A4C00        " # mov   esi, 0x4c3a70
      # abs_jmp_hack 0x42a523
      - "E800000000        " # call %%next
      - "C7042423A54200    " # mov dword [esp], %1
      - "C3                " # ret

codecaves:
  # Address range spanned by .text
  ExpHP.bullet-cap.address-range:
    - "00104000          " # dd 0x401000
    - "15AE4800          " # dd 0x48ae15

  ExpHP.bullet-cap.bullet-replacements:
    # istruc ListHeader
    - "D0070000          " # at ListHeader.old_cap, dd 0x7d0
    - "10090000          " # at ListHeader.elem_size, dd 0x910
    # iend
    - "D0070000          " # dd 0x7d0
    - "00000000          " # dd SCALE_1
    - "FFFFFFFF          " # dd BLACKLIST_BEGIN
    - "90C34100          " # dd 0x41c394 - 4
    - "53904500          " # dd 0x459057 - 4
    - "08B84600          " # dd 0x46b806 + 2  ; coincidental appearance in a jump
    - "00000000          " # dd BLACKLIST_END

    - "D1070000          " # dd 0x7d1
    - "00000000          " # dd SCALE_1
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "16D24600          " # dd 0x46d216  ; offset of dummy bullet state
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "74D64600          " # dd 0x46d674  ; offset of bullet.anm
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "78D64600          " # dd 0x46d678  ; size of bullet manager
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "10D64600          " # dd 0x46d610  ; size of bullet array
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "00000000          " # dd LIST_END

  ExpHP.bullet-cap.laser-replacements:
    # istruc ListHeader
    - "00000000          " # at ListHeader.old_cap, dd 0
    - "00000000          " # at ListHeader.elem_size, dd 0
    # iend
    - "00000000          " # dd LIST_END

  ExpHP.bullet-cap.cancel-replacements:
    # istruc ListHeader
    - "00000000          " # at ListHeader.old_cap, dd 0
    - "00000000          " # at ListHeader.elem_size, dd 0
    # iend
    - "00000000          " # dd LIST_END

  ExpHP.bullet-cap.iat-funcs:
    - "B8B14800          " # .GetLastError: dd 0x48b1b8
    - "00000000          " # .GetModuleHandleA: dd 0
    - "74B14800          " # .GetModuleHandleW: dd 0x48b174
    - "70B14800          " # .GetProcAddress: dd 0x48b170
