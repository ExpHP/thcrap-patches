
binhacks:
  ExpHP.bullet-cap.install:
    addr: "0x420ec8"
    expected: "e883b20200"
    codecave:
      - "E8[codecave:ExpHP.bullet-cap.initialize]" # call initialize

      # original code
      - "B850C14400        " # mov   eax, 0x44c150
      - "FFD0              " # call  eax
      # abs_jmp_hack 0x420ecd
      - "E800000000        " # call %%next
      - "C70424CD0E4200    " # mov dword [esp], %1
      - "C3                " # ret

  ExpHP.bullet-cap.fix-next-cancel:
    addr: "0x41bdf9"
    expected: "4281e2ff070080"
    codecave:
      - "52                " # push edx
      - "E8[codecave:ExpHP.bullet-cap.next-cancel-index]" # call next_cancel_index
      - "89C2              " # mov  edx, eax
      # abs_jmp_hack 0x41be0a
      - "E800000000        " # call %%next
      - "C704240ABE4100    " # mov dword [esp], %1
      - "C3                " # ret


codecaves:
  # Address range spanned by .text
  ExpHP.bullet-cap.address-range:
    - "00104000          " # dd 0x401000
    - "815A4600          " # dd 0x465a81

  ExpHP.bullet-cap.bullet-replacements:
    # istruc ListHeader
    - "D0070000          " # at ListHeader.old_cap, dd 0x7d0
    - "F0070000          " # at ListHeader.elem_size, dd 0x7f0
    # iend
    - "D0070000          " # dd 0x7d0
    - "00000000          " # dd SCALE_1
    - "FFFFFFFF          " # dd BLACKLIST_BEGIN
    - "09564100          " # dd 0x41560d - 4
    - "7EBD4400          " # dd 0x44bd82 - 4
    - "00000000          " # dd BLACKLIST_END

    - "D1070000          " # dd 0x7d1
    - "00000000          " # dd SCALE_1
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "A6073E00          " # dd 0x3e07a6  ; offset of dummy bullet state
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "500B3E00          " # dd 0x3e0b50  ; offset of bullet.anm
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "540B3E00          " # dd 0x3e0b54  ; size of bullet manager
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "D5820F00          " # dd 0xf82d5  ; num dwords in bullet manager
    - "04000000          " # dd SCALE_SIZE_DIV(4)
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "BC820F00          " # dd 0xf82bc  ; num dwords in bullet array
    - "04000000          " # dd SCALE_SIZE_DIV(4)
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "00000000          " # dd LIST_END

  ExpHP.bullet-cap.laser-replacements:
    # istruc ListHeader
    - "00010000          " # at ListHeader.old_cap, dd 0x100
    - "00000000          " # at ListHeader.elem_size, dd 0
    # iend
    - "00010000          " # dd 0x100
    - "00000000          " # dd SCALE_1
    - "01000000          " # dd WHITELIST_BEGIN
    - "16C54100          " # dd 0x41c51a - 4
    - "00000000          " # dd WHITELIST_END

    - "00000000          " # dd LIST_END

  ExpHP.bullet-cap.cancel-replacements:
    # istruc ListHeader
    - "00080000          " # at ListHeader.old_cap, dd 0x800
    - "F0030000          " # at ListHeader.elem_size, dd 0x3f0
    # iend
    - "96080000          " # dd 0x896  ; array size (includes non-cancel items)
    - "00000000          " # dd SCALE_1
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "C0CE2100          " # dd 0x21cec0  ; ItemManager size
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "A8730800          " # dd 0x873a8   ; array size in dwords
    - "04000000          " # dd SCALE_SIZE_DIV(4)
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "B0730800          " # dd 0x873b0   ; ItemManager size in dwords
    - "04000000          " # dd SCALE_SIZE_DIV(4)
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    # offsets of fields after array
    - "B4CE2100          " # dd 0x21ceb4  ; num items alive
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL
    - "B8CE2100          " # dd 0x21ceb8  ; next cancel item index
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL
    - "BCCE2100          " # dd 0x21cebc  ; num cancel items spawned this frame
    - "01000000          " # dd SCALE_SIZE
    - "FFFFFFFF00000000  " # dd REPLACE_ALL

    - "00000000          " # dd LIST_END

  ExpHP.bullet-cap.iat-funcs:
    - "DCFA4500          " # .GetLastError: dd 0x45fadc
    - "98614600          " # .GetModuleHandleA: dd 0x466198
    - "00000000          " # .GetModuleHandleW: dd 0
    - "58614600          " # .GetProcAddress: dd 0x466158
