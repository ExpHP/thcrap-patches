
binhacks:
  ExpHP.bullet-cap.install:
    addr: "0x420ec8"
    expected: "e883b20200"
    codecave:
      - "E8[codecave:ExpHP.bullet-cap.initialize]" # call initialize

      # original code
      - "B850C14400        " # mov   eax, 0x44c150
      - "FFD0              " # call  eax
      # abs_jmp_hack 0x420ecd
      - "E800000000        " # call %%next
      - "C70424CD0E4200    " # mov dword [esp], %1
      - "C3                " # ret

codecaves:
  # Address range spanned by .text
  ExpHP.bullet-cap.address-range:
    - "00104000          " # dd 0x401000
    - "815A4600          " # dd 0x465a81

  ExpHP.bullet-cap.bullet-data:
    - "D0070000          " # dd 0x7d0  ; old bullet count (not counting pre-TD dummy bullet)
    - "F0070000          " # dd 0x7f0  ; size of bullet

  # Here we have a list of numbers related to bullet count, each followed by a blacklist.
  # (i.e. addresses where this dword only appears incidentally and should not be replaced).
  # Each one will be substituted as  value -> value + new_count - old_count.
  ExpHP.bullet-cap.counts-to-replace:
    - "D0070000          " # dd 0x7d0
    - "09564100          " # dd 0x415609
    - "7EBD4400          " # dd 0x44bd7e
    - "00000000          " # dd 0 ; blacklist end

    - "D1070000          " # dd 0x7d1
    - "00000000          " # dd 0

    - "00000000          " # dd 0 ; END

  # Similar to counts_to_replace, but for BulletManager offsets that depend on the final bullet's offset.
  # These will be substituted as  value -> value + bullet_size * (new_count - old_count)
  #
  # Also sometimes the games do stuff like `rep stosd` and we have to divide size by 4 or something like that.
  ExpHP.bullet-cap.offsets-to-replace:
    - "A6073E00          " # dd 0x3e07a6  ; offset of dummy bullet state
    - "01000000          " # dd 1 ; use size as is
    - "00000000          " # dd 0
    - "500B3E00          " # dd 0x3e0b50  ; offset of bullet.anm
    - "01000000          " # dd 1 ; use size as is
    - "00000000          " # dd 0
    - "540B3E00          " # dd 0x3e0b54  ; size of bullet manager
    - "01000000          " # dd 1 ; use size as is
    - "00000000          " # dd 0
    - "D5820F00          " # dd 0xf82d5  ; num dwords in bullet manager
    - "04000000          " # dd 4 ; use size / 4
    - "00000000          " # dd 0
    - "BC820F00          " # dd 0xf82bc  ; num dwords in bullet array
    - "04000000          " # dd 4 ; use size / 4
    - "00000000          " # dd 0

    - "00000000          " # dd 0 ; END

  ExpHP.bullet-cap.iat-funcs:
    - "DCFA4500          " # .GetLastError: dd 0x45fadc
    - "98614600          " # .GetModuleHandleA: dd 0x466198
    - "00000000          " # .GetModuleHandleW: dd 0
    - "58614600          " # .GetProcAddress: dd 0x466158
