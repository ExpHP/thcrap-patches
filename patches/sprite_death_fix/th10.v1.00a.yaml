binhacks:
  ExpHP.sprite-death-fix.hack:
    addr: "0x442fe4"
    expected: "8bb8ccda7200"
    codecave:
      # Later games have this check but TH10 doesn't
      - "52                " # push edx  ; save (it's an argument to the current function)
      - "8B35101C4900      " # mov  esi, [ANM_MANAGER_PTR_10]
      - "8DB8CCDA7200      " # lea  edi, [eax+CURSOR_OFFSET_10]  ; write ptr
      - "8B07              " # mov  eax, [edi]
      - "05A8000000        " # add  eax, 0xa8
      - "39F8              " # cmp  eax, edi
      - "7C19              " # jl   .noreset

      # requires ANM_MANAGER in esi
      - "B8502F4400        " # mov  eax, FLUSH_SPRITES_10
      - "FFD0              " # call eax
      - "8D86CCDA3A00      " # lea  eax, [esi+BUFFER_OFFSET_10]
      - "8986CCDA7200      " # mov  [esi+CURSOR_OFFSET_10+0x0], eax  ; write cursor
      - "8986D0DA7200      " # mov  [esi+CURSOR_OFFSET_10+0x4], eax  ; read cursor

      # .noreset:
      - "5A                " # pop  edx
      # original code
      - "A1101C4900        " # mov  eax, [ANM_MANAGER_PTR_10]
      - "8BB8CCDA7200      " # mov  edi, dword [eax+CURSOR_OFFSET_10]

      # abs_jmp_hack 0x442fea
      - "E800000000        " # call %%next
      - "C70424EA2F4400    " # mov dword [esp], %1
      - "C3                " # ret
